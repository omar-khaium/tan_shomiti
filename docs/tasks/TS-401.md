# TS-401 — Eligibility Computation + Draw Recording

**Goal:** Compute month eligibility per share and record a draw result with verifiable inputs/outputs (audit-first).  
**Rules coverage (rules.md):** §7 (draw integrity + eligibility), §6.2–6.4 (deadline + proof), §12 (records), §2 (transparency).  
**Depends on:** TS-301 (monthly dues), TS-302 (payments), TS-303 (eligibility gate), TS-202 (shares).  
**Out of scope:** witness sign-off + redo flow (TS-402), payout approval (TS-403).

## Stage 1 (Figma)

> Figma URLs pending. Until a Figma file is provided, this spec acts as the UI contract for Stage 2.

### Screen A — Eligible shares (month snapshot)

Purpose:
- Show **who is eligible to participate in the draw** for the selected month.
- Eligibility is **per share**, not per person (multiple shares create multiple draw entries).

Content:
- Month header with prev/next month navigation (reuse existing month pattern).
- Summary: `Eligible entries`, `Ineligible entries` and the reason counts.
- List rows:
  - Member name + share count
  - Eligibility badge: `Eligible` / `Ineligible`
  - Reason when ineligible (e.g. “Payment not confirmed”, “Late (outside grace)”)

States:
- Loading: skeleton list
- Empty: “No dues generated for this month yet”
- Error: “Failed to load eligibility”

Required keys (for tests):
- `eligibility_month_label`
- `eligibility_row_<position>`
- `eligibility_badge_<position>`
- `eligibility_reason_<position>`
- `eligibility_run_draw`

### Screen B — Run draw (record inputs + result)

Purpose:
- Record how the draw was run, and the result.

Content:
- Method selection (must match `RuleSetSnapshot.drawPolicy` once implemented):
  - Physical slips
  - Numbered tokens
  - Simple randomizer (only if explicitly allowed)
- Inputs:
  - “Proof reference” (free-text): video/screenshot/link id
  - Optional notes
- Output:
  - Selected winning share/member (auto-selected by method flow or manually entered with confirmation)
  - “Save draw result” button

Required keys (for tests):
- `draw_method_physical`
- `draw_method_tokens`
- `draw_method_randomizer`
- `draw_proof_ref`
- `draw_notes`
- `draw_selected_winner`
- `draw_save`

## Acceptance criteria
- Eligibility list is derived from **confirmed payments** and the active late/grace policy (TS-303).
- A draw cannot be recorded if there are **no eligible entries** for the month.
- Recording a draw appends an **audit event** with method + proof reference + winner.
- Winner share is marked as **won for the cycle** and excluded from future eligibility (domain invariant).

