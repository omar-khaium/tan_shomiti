# TS-202 — Shares Management (Single/Multiple Shares)

## Goal

Allocate shares per member, enforce caps (Section 10), and compute pot basics (Section 5) using the active `RuleSetVersion` snapshot.

## Rules Coverage (`rules.md`)

- **Section 5**: Shares & pot rules (fixed shares, pot definition, transfer policy defaults)
- **Section 10**: Multiple shares per person (cap + fairness constraints)

## Depends On

- TS-101 Shomiti Setup Wizard (policies + N + share value S)
- TS-201 Members CRUD (member list exists)

## Out of Scope

- Share transfers workflow (optional later extension)
- Draw eligibility (Sprint 4)

---

## Stage 1 — Figma (UI + Interaction Spec)

### Frames to design
- Shares overview
  - total shares
  - monthly pot estimate
  - policy summary (max shares/person, transfers allowed)
- Assign shares
  - per-member share count input (stepper/text)
  - validation inline errors (cap exceeded)
  - warning copy for multiple shares (fairness)
- Review/confirm
  - shows computed totals and constraints

### Interaction notes
- Max shares per person enforced from `RuleSetVersion`.
- Transfers:
  - If disabled (recommended), UI should communicate “not allowed”.
  - If enabled, note unanimous approval is required (record-only for now).

### Accessibility notes
- Accessible steppers and focus order

### Figma URLs (fill)
- File:
- Nodes:
  - Shares overview:
  - Assign shares:
  - Review:

### Commit
- `TS-202 (stage1): figma spec`

### Stage 1 checks
- `flutter analyze`
- `flutter test`

---

## Stage 2 — Flutter UI (1:1 from Figma)

### Deliverables
- Shares overview + assignment UI using demo data.
- Uses design-system components and stable keys for Patrol tests.

### Commit
- `TS-202 (stage2): flutter ui`

### Stage 2 checks
- `flutter analyze`
- `flutter test`

---

## Stage 3 — Integration (Domain + Data + Persistence)

### Deliverables
- Domain:
  - `ShareAllocation` model
  - use case: `AssignSharesToMember` enforcing cap and fixed shares rules
- Data:
  - Drift tables + repositories
  - audit events for allocations
- Presentation:
  - controllers wired, computed totals visible

### Commit
- `TS-202 (stage3): domain+data integration`

### Stage 3 checks
- `flutter analyze`
- `flutter test`

---

## Stage 4 — Unit Tests

### Deliverables
- Cap enforcement tests (Section 10)
- Pot calculation correctness tests (Section 5)

### Commit
- `TS-202 (stage4): unit tests`

### Stage 4 checks
- `flutter test`

---

## Stage 5 — Patrol UI Tests

### Deliverables
- Patrol: assign shares and verify validation and totals.

### Commit
- `TS-202 (stage5): patrol tests`

### Stage 5 checks
- `patrol test`

---

## Stage 6 — E2E Tests

### Deliverables
- E2E: setup → add members → assign shares → verify pot totals.

### Commit
- `TS-202 (stage6): e2e tests`

### Stage 6 checks
- `patrol test` (E2E suite)

---

## Definition of Done

- All 6 stages complete and committed
- PR checks green
- E2E green
- Merged to `main` (rebase merge) + branch deleted

