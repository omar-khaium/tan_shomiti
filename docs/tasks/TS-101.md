# TS-101 — Shomiti Setup Wizard (RuleSetVersion snapshot)

## Goal

Create a Shomiti and capture an immutable `RuleSetVersion` snapshot covering `rules.md` Section **1** (setup fields) plus required policy choices (e.g., Sections **5, 6, 9.2, 10, 11, 15**).

This task replaces the current `/setup` placeholder with a real wizard and persists the configuration locally.

## Rules Coverage (`rules.md`)

- **Section 1**: Setup fields (name, start date, N, S, schedule, deadline, payout method, etc.)
- **Section 5**: Shares policy constraints (fixed shares, transfer policy defaults)
- **Section 6**: Contribution rules (due amounts inputs + receipt method selection)
- **Section 9.2**: Short pot policy selection (A/B/C)
- **Section 9.1**: Late policy inputs (grace + optional late fee)
- **Section 10**: Multiple shares constraints (cap inputs)
- **Section 11**: Fees policy (optional)
- **Section 15**: Rule change policy defaults (unanimous after start)

## Depends On

- TS-001 App Shell + Navigation
- TS-002 Design System
- TS-003 Data & Audit Foundation
- TS-004 Test Harness Setup

## Out of Scope

- Member sign-off / role assignments (TS-102)
- Rules viewer UX (TS-103)
- Contributions, draws, payouts, disputes (later sprints)

---

## Stage 1 — Figma (UI + Interaction Spec)

### Frames to design
- Wizard entry screen: “Set up your Shomiti”
- Step 1: Shomiti name + start date
- Step 2: Group type (closed/open) + member count (N) + share value (S)
- Step 3: Shares policy (max shares per person, allow transfers toggle)
- Step 4: Meeting schedule + payment deadline
- Step 5: Missed payment policy (A/B/C) + optional late policy inputs
- Step 6: Optional fees (Section 11)
- Step 7: Review summary + “Create Shomiti”
- Success screen: redirect to dashboard

### Interaction notes
- Wizard should be resumable (persist draft or keep local state until submit).
- Validation is strict and rule-driven (no invalid combos).
- Copy is neutral, privacy-safe, and avoids shaming language.

### Accessibility notes
- Tap targets ≥ 44px
- Keyboard-friendly (next/done)
- Clear error messages tied to fields

### Figma URLs (fill)
- File:
- Nodes:
  - Wizard entry:
  - Wizard steps:
  - Review:
  - Success:

### Commit
- `TS-101 (stage1): figma spec`

### Stage 1 checks
- `flutter analyze`
- `flutter test`

---

## Stage 2 — Flutter UI (1:1 from Figma)

### Deliverables
- Replace `SetupPlaceholderPage` with a real `SetupWizardPage` UI flow.
- No persistence yet; use in-memory state and “demo submit” to reach dashboard.
- Uses design-system components (TS-002).

### Commit
- `TS-101 (stage2): flutter ui`

### Stage 2 checks
- `flutter analyze`
- `flutter test` (widget tests for wizard navigation + validation rendering)

---

## Stage 3 — Integration (Domain + Data + Persistence)

### Deliverables
- Domain:
  - `RuleSetSnapshot` (typed) + serialization for storage.
  - `Shomiti` entity (minimal for MVP) + repository interface.
  - Use case: `CreateShomiti` → creates `Shomiti` + `RuleSetVersion` (immutable).
- Data:
  - Drift table(s) for Shomiti and persistence for active configuration.
  - Implement `ShomitiRepository` (local-first).
  - Update router guard to read “configured” state from repository, not in-memory.
- Presentation:
  - Setup wizard controller calls `CreateShomiti` and navigates on success.
  - Record audit event(s) for shomiti creation and rule snapshot creation.

### Commit
- `TS-101 (stage3): domain+data integration`

### Stage 3 checks
- `flutter analyze`
- `flutter test`

---

## Stage 4 — Unit Tests

### Deliverables
- Use case tests:
  - Validates required fields and basic invariants (e.g., N > 0, S > 0).
  - Enforces “unanimous after start” default for amendments policy.
- Repository tests:
  - Persist and fetch active Shomiti + RuleSetVersion.

### Commit
- `TS-101 (stage4): unit tests`

### Stage 4 checks
- `flutter test`

---

## Stage 5 — Patrol UI Tests

### Deliverables
- Patrol flow:
  - fresh install → setup wizard opens
  - complete wizard happy path → dashboard visible
  - verify key fields validation blocks submit when missing

### Commit
- `TS-101 (stage5): patrol tests`

### Stage 5 checks
- `patrol test`

---

## Stage 6 — E2E Tests

### Deliverables
- Add E2E coverage for “fresh install → setup → dashboard”.
- Ensure existing E2E suite remains green (components gallery + audit/ledger smoke).

### Commit
- `TS-101 (stage6): e2e tests`

### Stage 6 checks
- `patrol test` (E2E suite)

---

## Definition of Done

- All 6 stages complete and committed
- PR checks green
- E2E green
- Merged to `main` (rebase merge) + branch deleted

