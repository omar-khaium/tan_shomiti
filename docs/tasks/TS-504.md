# TS-504 — Disputes Workflow

## Goal
Implement a **disputes tracking workflow** aligned with `rules.md` Section 13 so the group can:
- record disputes with evidence and notes,
- track step-by-step resolution progress,
- keep an auditable trail without exposing sensitive personal data unnecessarily.

## Rules coverage
`rules.md`:
- **13) Disputes & Resolution**
  1) private discussion with Coordinator + Treasurer
  2) meeting discussion with witnesses + ledger review
  3) mediation by agreed neutral member(s)
  4) final: formal/legal remedies (record outcome, no legal advice)

## Non-goals (this task)
- Provide legal advice or local-law interpretation (out of scope)
- External messaging integrations (WhatsApp/Telegram) (out of scope)
- Export/printing (TS-601)

## UX / Screens

### 1) Disputes list (new)
Accessible from `More` → `Disputes`.

Shows:
- open disputes (default)
- resolved/archived disputes (tab/filter)
- each row shows:
  - title/summary
  - status (which step it’s on)
  - createdAt

Actions:
- `Create dispute`
- open dispute details

### 2) Create dispute (new)
Minimal required fields:
- short title (required)
- description (required; neutral language)
- related month (optional)
- involved members (optional)
- evidence reference(s) (optional; e.g., chat link/message id, receipt ref)

### 3) Dispute detail (new)
Sections:
- summary (title, createdAt, involved members)
- timeline/steps (Section 13):
  - Step 1: private discussion
  - Step 2: meeting + witnesses + ledger review
  - Step 3: mediation
  - Step 4: final outcome

Each step supports:
- notes (required to mark step complete)
- optional proof reference
- participants (optional)
- `Mark step complete`

Resolution:
- `Resolve dispute` (requires final outcome note)
- `Reopen` (optional; if new info appears)

## Domain rules (acceptance)
- Disputes must follow the ordered step workflow:
  - cannot complete Step N+1 before Step N is complete.
- All notes are written in **non-shaming, factual language**.
- Evidence/proof is stored as **references** (text), not media upload (MVP).
- Audit events recorded:
  - `dispute_created`
  - `dispute_step_completed`
  - `dispute_resolved`
  - `dispute_reopened` (if supported)

## Data requirements
- Persist disputes and their steps locally (Drift).
- Each step completion includes:
  - note
  - optional proof reference
  - completedAt

## Architecture notes
- Clean Architecture:
  - `disputes/domain`: entities + policy + use-cases
  - `disputes/data`: drift tables + repositories
  - `disputes/presentation`: Riverpod providers/controllers + UI

## Figma
- Figma file/page/node: **TBD** (Stage 1 placeholder)
- (Optional) FigJam: workflow diagram for Section 13 steps.

## Stage-specific testing expectations

### Stage 2 (UI)
- Widget tests for list empty/loading/error states.
- Detail page renders steps and disables out-of-order progression.

### Stage 3 (logic)
- Unit tests enforce ordered step completion.
- Repository tests for persistence.

### Stage 5 (Patrol)
- Create dispute → complete Step 1 → verify Step 2 enabled.

### Stage 6 (E2E)
- Full flow: create → progress through steps → resolve → reopen (optional).

