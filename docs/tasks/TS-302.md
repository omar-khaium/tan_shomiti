# TS-302 — Record Payments + Receipts

**Goal:** Record monthly contributions with proof/reference and issue a receipt per payment.  
**Rules coverage (rules.md):** §6 (Monthly contribution rules), §12 (Records & transparency), §16 (Privacy & conduct).  
**Depends on:** TS-301 (monthly dues), TS-201 (members).  
**Out of scope:** bank/mobile wallet integrations, cloud sync, PDF receipts (TS-601), monthly statement generation (TS-501).

## Stage 1 (Figma)

> Figma URLs are pending. If no Figma file is provided, this spec acts as the UI contract for Stage 2.

### Screens / states

1) **Dues (monthly) list enhancements**
- For each member row:
  - due amount (already present)
  - payment status: `Unpaid` / `Paid` (and optional partial info if added later)
  - action: `Record payment` (Unpaid), `View receipt` (Paid)
- Global: month switcher persists.

2) **Record payment sheet/dialog**
- Fields:
  - amount (BDT) (defaults to due amount)
  - method (Cash / Bank transfer / Mobile wallet / Other)
  - reference (required; for cash this can be receipt number or note)
  - proof note (optional; placeholder for future file/screenshot attachment)
- Actions:
  - Cancel
  - Save (records payment, issues receipt)
- States:
  - validation errors (inline)
  - saving (disabled buttons + progress)

3) **Receipt view**
- Shows:
  - receipt number
  - member name
  - month
  - amount
  - method + reference
  - recorded time
- Actions:
  - Close

### Accessibility + privacy
- Do not show sensitive personal details (NID/address) on payment/receipt surfaces.
- Use non-judgmental copy (no shaming). Status labels must be neutral: “Unpaid”, “Paid”.
- All interactive elements must have keys for Patrol.

### Required keys (for tests)
- Dues row actions:
  - `dues_record_payment_<position>`
  - `dues_view_receipt_<position>`
- Record payment dialog:
  - `payment_amount`
  - `payment_method`
  - `payment_reference`
  - `payment_proof_note`
  - `payment_confirm`
  - `payment_cancel`
- Receipt dialog:
  - `receipt_dialog`
  - `receipt_number`

## Stage 2 (Flutter UI)
- Implement dialog/sheet UI + list row status visuals.
- No persistence required yet (may use demo/in-memory state).

## Stage 3 (Domain + data integration)
- Add local persistence for payments + receipts.
- Use cases:
  - `RecordPayment` (validations)
  - `IssueReceipt` (receipt number + timestamp)
- Append audit events:
  - `payment_recorded`
  - `receipt_issued`

## Acceptance criteria
- A payment can be recorded for a due row, with required method + reference.
- “Paid” status reflects persistence (navigate away/back).
- A receipt can be viewed after payment is recorded.
- Audit log contains a line item for payment recorded and receipt issued.

