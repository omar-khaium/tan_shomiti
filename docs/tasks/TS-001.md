# TS-001 — App Shell + Navigation

## Goal

Establish the app bootstrap, routing, and a stable application shell that all later features plug into.

## Rules Coverage (`rules.md`)

Foundational (supports all rules by enabling predictable flows, transparency screens, and safe UX copy).

## Depends On

None.

## Out of Scope

- Domain/business rules enforcement (starts in TS-101+).
- Database/persistence (TS-003).
- Design system tokens/components beyond what is needed for the shell (TS-002).

---

## Stage 1 — Figma (UI + Interaction Spec)

### Frames to design
- App shell (mobile) with:
  - top app bar (title + overflow)
  - primary navigation (tabs/bottom nav or drawer — choose one and justify)
  - content area (list/detail layout ready)
- Empty state (no Shomiti yet) → CTA to start setup wizard
- Global loading state (app bootstrap)
- Global error state (recoverable + retry)
- “Not configured yet” guard screen (when Shomiti missing)
- Responsive variants:
  - small phone
  - large phone
  - optional tablet (split view or centered layout)

### Interaction notes
- Navigation rules:
  - Deep linkable routes for each top-level section (Dashboard/Members/Contributions/Draw/Payout/Ledger/Rules/Disputes/Settings)
  - Route guard behavior:
    - if no Shomiti exists: always redirect to Setup/Guard screen
    - if Shomiti exists: open dashboard
- Error handling:
  - global error page shows a safe message (no blame/shaming language)
  - provides retry action and a way to view details (optional, redacted)

### Accessibility notes
- Tap targets ≥ 44px
- Sufficient contrast for text and status badges
- Clear focus order (especially for forms/CTAs)

### Figma URLs (fill)
- File:
- Nodes:
  - App Shell:
  - Empty/Guard:
  - Loading:
  - Error:

### Commit
- `TS-001 (stage1): figma spec`

### Stage 1 checks
- `flutter analyze`
- `flutter test`

---

## Stage 2 — Flutter UI (1:1 from Figma)

### Deliverables
- `AppShell` widget with navigation + placeholders for feature routes.
- Shared UI primitives for:
  - loading view
  - error view
  - empty/guard view
- No business logic in widgets (controllers only).

### Commit
- `TS-001 (stage2): flutter ui`

### Stage 2 checks
- `flutter analyze`
- `flutter test` (widget tests for loading/empty/error)

---

## Stage 3 — Integration (Bootstrap + Routing + Guards)

### Deliverables
- App bootstrap wiring:
  - `ProviderScope` at root
  - router configured (recommended: `go_router`)
  - route guard for “Shomiti exists”
- Placeholder repositories/interfaces may be used until TS-003, but keep layering:
  - presentation → domain (use-cases) only
  - no data layer coupling in UI

### Commit
- `TS-001 (stage3): domain+data integration`

### Stage 3 checks
- `flutter analyze`
- `flutter test`

---

## Stage 4 — Unit Tests

### Deliverables
- Unit tests for route guard decision logic (given “configured/unconfigured”).

### Commit
- `TS-001 (stage4): unit tests`

### Stage 4 checks
- `flutter test`

---

## Stage 5 — Patrol UI Tests

### Deliverables
- Patrol smoke:
  - launch app
  - verify shell renders
  - navigate between top-level sections

### Commit
- `TS-001 (stage5): patrol tests`

### Stage 5 checks
- `patrol test`

---

## Stage 6 — E2E Tests

### Deliverables
- E2E-00: “launch → shell visible” (baseline)
- Ensure test is stable across at least one target device/emulator.

### Commit
- `TS-001 (stage6): e2e tests`

### Stage 6 checks
- `patrol test` (E2E suite)

---

## Definition of Done

- All 6 stages complete and committed
- PR checks green
- E2E green
- Merged to `main` (rebase merge) + branch deleted

