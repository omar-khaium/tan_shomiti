# TS-304 — Short Pot Handling Policies (No Partial Payout)

**Goal:** Enforce “no partial pot payout” and implement `rules.md` §9.2 short-pot policies A/B/C for a monthly collection.  
**Rules coverage (rules.md):** §6.5 (no partial pot payout), §9.2 (short pot policy A/B/C), §12 (records transparency).  
**Depends on:** TS-301 (monthly dues), TS-302 (payments/receipts), TS-101 (missedPaymentPolicy selection).  
**Out of scope:** actual payout transfer/proof (TS-403), draw execution (TS-401), reserve funding mechanics beyond bookkeeping (can be iterative).

## Stage 1 (Figma)

> Figma URLs are pending. If no Figma file is provided, this spec acts as the UI contract for Stage 2.

### Screen: Monthly collection status

Context: `BillingMonth` + current shomiti.

Show:
- **Total due** (from dues table): `sum(memberShares * S)`
- **Collected** (sum of confirmed payments for the month)
- **Shortfall** = `totalDue - collected` (>= 0)
- **Status badge**:
  - `Complete` when shortfall == 0
  - `Short` when shortfall > 0

Actions (depends on `missedPaymentPolicy`):

**Policy A — Postpone payout (recommended)**
- When shortfall > 0:
  - Show “Payout postponed until full collection is complete.”
  - No additional action besides recording remaining payments.

**Policy B — Cover from reserve**
- When shortfall > 0:
  - Show “Reserve can temporarily cover shortfall.”
  - Action: `Cover shortfall from reserve` (records a reserve-cover entry)
  - Requirement: audit log entry + ledger entry for reserve debit

**Policy C — Emergency cover by guarantor**
- When shortfall > 0:
  - Show “Guarantor cover required within configured window.”
  - Action: `Mark guarantor cover` (records cover + proof note)
  - Requirement: audit log entry

### Required keys (for tests)
- `collection_total_due`
- `collection_total_collected`
- `collection_shortfall`
- `collection_status_badge`
- `collection_cover_reserve`
- `collection_mark_guarantor_cover`

## Acceptance criteria
- Shortfall is computed deterministically from persisted dues + payments.
- “No partial payout” is enforced by exposing a `collectionClosed`/`readyForPayout` flag:
  - `readyForPayout == true` only when shortfall == 0 OR policy resolves the shortfall.
- Audit events are appended for any policy action (reserve cover / guarantor cover).

