# TS-204 — Exit, Replacement, Removal (Governance ops)

## Goal

Support controlled member exit, replacement, and removal for misconduct in a transparent way aligned with `rules.md` Section **14**.

## Rules Coverage (`rules.md`)

- **Section 14**: Exit, replacement, and removal (no exit without replacement recommended; unanimous approval; settlement rules documented)

## Depends On

- TS-201 Members CRUD
- TS-101 RuleSetVersion snapshot (policy context)

## Out of Scope

- Money settlement calculations (later sprints when ledger/contributions exist)
- Disputes workflow (TS-504)

---

## Stage 1 — Figma (UI + Interaction Spec)

### Frames to design
- Member status change screen
  - actions: request exit, propose replacement, remove for misconduct
- Replacement workflow
  - select outgoing member
  - add replacement candidate (lightweight profile)
  - show approvals required (unanimous)
  - show settlement checklist (payments settled, obligations accepted)
- Removal for misconduct
  - reason selection + free text
  - unanimous vote capture (or governance policy)
  - confirmation dialog (strong warning copy)

### Interaction notes
- Enforce “no exit without replacement” by default (recommended), unless policy allows otherwise.
- Always record decision proof and timestamp.
- Keep language respectful and non-accusatory.

### Figma URLs (fill)
- File:
- Nodes:
  - Status change:
  - Replacement flow:
  - Removal flow:

### Commit
- `TS-204 (stage1): figma spec`

### Stage 1 checks
- `flutter analyze`
- `flutter test`

---

## Stage 2 — Flutter UI (1:1 from Figma)

### Deliverables
- Screens for exit/replacement/removal using demo data.
- Stable keys for Patrol tests.

### Commit
- `TS-204 (stage2): flutter ui`

### Stage 2 checks
- `flutter analyze`
- `flutter test`

---

## Stage 3 — Integration (Domain + Data + Persistence)

### Deliverables
- Domain:
  - models for `MembershipChangeRequest` and `Approval`
  - use cases: `RequestExit`, `ProposeReplacement`, `ApproveMembershipChange`, `RemoveForMisconduct`
  - enforce unanimous approval where required
- Data:
  - Drift tables + repositories
  - audit events for proposals/approvals/finalization
- Presentation:
  - controllers wired; status changes visible on member list/detail

### Commit
- `TS-204 (stage3): domain+data integration`

### Stage 3 checks
- `flutter analyze`
- `flutter test`

---

## Stage 4 — Unit Tests

### Deliverables
- Unanimous approval enforcement tests
- “no exit without replacement” default tests

### Commit
- `TS-204 (stage4): unit tests`

### Stage 4 checks
- `flutter test`

---

## Stage 5 — Patrol UI Tests

### Deliverables
- Patrol:
  - request exit → propose replacement → approvals → completed status
  - removal flow shows confirmation

### Commit
- `TS-204 (stage5): patrol tests`

### Stage 5 checks
- `patrol test`

---

## Stage 6 — E2E Tests

### Deliverables
- E2E: setup → add members → execute replacement workflow → verify statuses.

### Commit
- `TS-204 (stage6): e2e tests`

### Stage 6 checks
- `patrol test` (E2E suite)

---

## Definition of Done

- All 6 stages complete and committed
- PR checks green
- E2E green
- Merged to `main` (rebase merge) + branch deleted

